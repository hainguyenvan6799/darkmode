/* global grn_split_tags, GRN_MsgBox, GRN_MsgBoxButtons*/
!function($){"use strict";grn.base.namespace("grn.component.ajax.error_handler");var G=grn.component.ajax.error_handler,i18n=grn.component.i18n;G.settings={errorView:grn.component.ajax.error_default_view},G.getHeader=function(request){if("function"===typeof request.getAllResponseHeaders)return request.getAllResponseHeaders()},G.getCybozuError=function(request){var headers,match=G.getHeader(request).match(/X-Cybozu-Error: (.*)/i);return 2===match.length?match[1]:null},G.hasCybozuError=function(request){var headers=G.getHeader(request);return!(!headers||!headers.match(/X-Cybozu-Error/i))},G.hasCybozuLogin=function(request){var headers=G.getHeader(request);return headers.match(/X-CybozuLogin/i)||!headers.match(/X-Cybozu-User/i)},G.show=function(request,on_close){var responseText=request.responseText,title="",content="",error_json=null,resources=this._loadResources();if("undefined"!==typeof responseText){try{error_json=JSON.parse(responseText)}catch(e){}error_json?content=this._createCybozuErrorContent(error_json):""!==responseText&&(title=resources.error,content=grn_split_tags(responseText,1e3))}""===content&&(title=resources.error,content=resources.undefinedError),GRN_MsgBox.show(content,title,GRN_MsgBoxButtons.ok,{ui:[],caption:{ok:resources.ok},callback:function(){GRN_MsgBox._remove(),"function"===typeof on_close&&on_close()}})},G._createCybozuErrorContent=function(error){return this.settings.errorView.render(error)},G._loadResources=function(){return{error:i18n.cbMsg("fw.error","Error"),undefinedError:i18n.cbMsg("grn","ajax_undefined_error"),ok:i18n.cbMsg("grn.common","ok")}}}(jQuery);