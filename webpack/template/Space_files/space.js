/**
 *
 */
grn.base.namespace("grn.component.space"),grn.component.space.BalloonField=function(balloonFieldData){this.balloonFieldData=balloonFieldData},grn.component.space.BalloonField.SHOW="show",grn.component.space.BalloonField.HIDE="hide",grn.component.space.BalloonField.prototype.render=function(balloonElementId,borderElementId,edgeElementId){this.balloonElementId=balloonElementId,this.borderElementId=borderElementId,this.edgeElementId=edgeElementId,this.balloonFieldData.balloonStatus==grn.component.space.BalloonField.SHOW?(jQuery("#"+this.balloonElementId).show(),jQuery("#"+this.edgeElementId).show()):(jQuery("#"+this.balloonElementId).hide(),jQuery("#"+this.edgeElementId).hide()),this.balloonFieldData.borderStatus==grn.component.space.BalloonField.SHOW?jQuery("#"+this.borderElementId).show():jQuery("#"+this.borderElementId).hide()},grn.component.space.BalloonField.prototype.showBalloon=function(){this.balloonFieldData.balloonStatus==grn.component.space.BalloonField.HIDE&&(this.balloonFieldData.balloonStatus=grn.component.space.BalloonField.SHOW,jQuery("#"+this.balloonElementId).show(),jQuery("#"+this.edgeElementId).show())},grn.component.space.BalloonField.prototype.hideBalloon=function(){this.balloonFieldData.balloonStatus==grn.component.space.BalloonField.SHOW&&(this.balloonFieldData.balloonStatus=grn.component.space.BalloonField.HIDE,jQuery("#"+this.balloonElementId).hide(),jQuery("#"+this.edgeElementId).hide())},grn.component.space.BalloonField.prototype.showBorder=function(){this.balloonFieldData.borderStatus==grn.component.space.BalloonField.HIDE&&(this.balloonFieldData.borderStatus=grn.component.space.BalloonField.SHOW,jQuery("#"+this.borderElementId).show())},grn.component.space.BalloonField.prototype.hideBorder=function(){this.balloonFieldData.borderStatus==grn.component.space.BalloonField.SHOW&&(this.balloonFieldData.borderStatus=grn.component.space.BalloonField.HIDE,jQuery("#"+this.borderElementId).hide())},grn.component.space.CustomEvent=function(eventType){this.eventType=eventType,this.bus=jQuery({})},grn.component.space.CustomEvent.prototype.subscribe=function(handler){this.bus.on(this.eventType,handler)},grn.component.space.CustomEvent.prototype.unsubscribe=function(handler){},grn.component.space.CustomEvent.prototype.fire=function(args){this.bus.trigger(this.eventType,args)},grn.component.space.ImageToggleButton=function(toggleButtonData){this.toggleButtonData=toggleButtonData,this.onToggleButtonOn=new grn.component.space.CustomEvent("onToggleButtonOn"),this.onToggleButtonOff=new grn.component.space.CustomEvent("onToggleButtonOff")},grn.component.space.ImageToggleButton.STATUS_ON="on",grn.component.space.ImageToggleButton.STATUS_OFF="off",grn.component.space.ImageToggleButton.prototype.addToggleButtonOnSubscriber=function(subscriber){this.onToggleButtonOn.subscribe(subscriber)},grn.component.space.ImageToggleButton.prototype.addToggleButtonOffSubscriber=function(subscriber){this.onToggleButtonOff.subscribe(subscriber)},grn.component.space.ImageToggleButton.prototype.render=function(buttonElementId){this.buttonElementId=buttonElementId,this.isOn()?(jQuery("#"+this.buttonElementId).addClass("space-show-icon-base-on-grn"),jQuery("#"+this.buttonElementId).removeClass("space-show-icon-base-off-grn")):(jQuery("#"+this.buttonElementId).addClass("space-show-icon-base-off-grn"),jQuery("#"+this.buttonElementId).removeClass("space-show-icon-base-on-grn")),jQuery("#"+this.buttonElementId).on("click",jQuery.proxy(this.toggle,this))},grn.component.space.ImageToggleButton.prototype.isOn=function(){return this.toggleButtonData.status==grn.component.space.ImageToggleButton.STATUS_ON},grn.component.space.ImageToggleButton.prototype.toggle=function(){this.isOn()?this.toggleOff():this.toggleOn()},grn.component.space.ImageToggleButton.prototype.toggleOn=function(){jQuery("#"+this.buttonElementId).addClass("space-show-icon-base-on-grn"),jQuery("#"+this.buttonElementId).removeClass("space-show-icon-base-off-grn"),this.toggleButtonData.status=grn.component.space.ImageToggleButton.STATUS_ON,this.onToggleButtonOn.fire(this)},grn.component.space.ImageToggleButton.prototype.toggleOff=function(){jQuery("#"+this.buttonElementId).removeClass("space-show-icon-base-on-grn"),jQuery("#"+this.buttonElementId).addClass("space-show-icon-base-off-grn"),this.toggleButtonData.status=grn.component.space.ImageToggleButton.STATUS_OFF,this.onToggleButtonOff.fire(this)},grn.component.space.MemberField=function(memberFieldData,resource){this.memberFieldData=memberFieldData,this.resource=resource},grn.component.space.MemberField.STATUS_SHOW="show",grn.component.space.MemberField.STATUS_HIDE="hide",grn.component.space.MemberField.prototype.render=function(fieldElementId){this.fieldElementId=fieldElementId,this.memberFieldData.status==grn.component.space.MemberField.STATUS_SHOW?jQuery("#"+fieldElementId).show():jQuery("#"+fieldElementId).hide(),this.onMemberFieldOpenEvent=new grn.component.space.CustomEvent("onMemberFieldOpen"),this.onMemberFieldCloseEvent=new grn.component.space.CustomEvent("onMemberFieldClose"),jQuery("#"+this.fieldElementId+"-close").on("click",jQuery.proxy(this.closeMemberField,this))},grn.component.space.MemberField.prototype.addMemberFieldOpenEventSubscriber=function(subscriber){this.onMemberFieldOpenEvent.subscribe(subscriber)},grn.component.space.MemberField.prototype.addMemberFieldCloseEventSubscriber=function(subscriber){this.onMemberFieldCloseEvent.subscribe(subscriber)},grn.component.space.MemberField.prototype.openMemberField=function(){if(this.isMemberFieldClosed()){this.memberFieldData.status=grn.component.space.MemberField.STATUS_SHOW,jQuery("#"+this.fieldElementId).show();var openStatus="1",request;new grn.component.ajax.request({url:this.resource.statusPost,method:"post",grnRedirectOnLoginError:true,data:{spid:this.memberFieldData.spaceId,status:"1",csrf_ticket:this.resource.csrfTicket}}).send(),this.onMemberFieldOpenEvent.fire(this)}},grn.component.space.MemberField.prototype.closeMemberField=function(){if(!this.isMemberFieldClosed()){this.memberFieldData.status=grn.component.space.MemberField.STATUS_HIDE,jQuery("#"+this.fieldElementId).hide();var openStatus="0",request;new grn.component.ajax.request({url:this.resource.statusPost,method:"post",grnRedirectOnLoginError:true,data:{spid:this.memberFieldData.spaceId,status:"0",csrf_ticket:this.resource.csrfTicket}}).send(),this.onMemberFieldCloseEvent.fire(this)}},grn.component.space.MemberField.prototype.toggleMemberField=function(){this.isMemberFieldClosed()?this.openMemberField():this.closeMemberField()},grn.component.space.MemberField.prototype.isMemberFieldClosed=function(){return this.memberFieldData.status==grn.component.space.MemberField.STATUS_HIDE},grn.component.space.MemberField.prototype.showRemainingMember=function(){var request=new grn.component.ajax.request({url:this.resource.remainingMemberUrl,grnRedirectOnLoginError:true,method:"post",dataType:"json",data:"spid="+this.memberFieldData.spaceId,beforeSend:function(){jQuery("#display_member_close").hide();var spinner=jQuery("<img src='"+this.resource.spinner+"'>");spinner.css({height:16,width:16}),jQuery("#remaining_member").html(spinner)}.bind(this)});request.on("beforeShowError",function(e,jqXHR){jQuery("#display_member_close").show(),jQuery("#remaining_member").html("")}),request.send().done(function(data){jQuery("#remaining_member").html(data.remainingMember),jQuery("#display_member_open").show();var $members=jQuery("#remaining_member").find(".span-member-dialog"),dialog;grn.component.member_list_dialog.get_instance("member_list_dialog").bind_dialog_to_members($members)})},grn.component.space.MemberField.prototype.hideRemainingMember=function(){jQuery("#display_member_open").hide(),jQuery("#display_member_close").show(),jQuery("#remaining_member").html("")},grn.component.space.MemoField=function(memoData,resource){this.memoData=memoData,this.resource=resource,this.childView=null},grn.component.space.MemoField.STATUS_SHOW="show",grn.component.space.MemoField.STATUS_HIDE="hide",grn.component.space.MemoField.CLASS_SWITCH_ON="icon-toggleMemo-hide-grn",grn.component.space.MemoField.CLASS_SWITCH_OFF="icon-toggleMemo-show-grn",grn.component.space.MemoField.CLASS_INNER_DIV="space-spaceMemo-inner-grn",grn.component.space.MemoField.prototype.render=function(fieldElementId){this.fieldElementId=fieldElementId;var fieldElement=jQuery("#"+this.fieldElementId);this.memoData.status==grn.component.space.MemoField.STATUS_SHOW&&fieldElement.show(),jQuery("#"+this.fieldElementId+"-view-edit").length&&jQuery("#"+this.fieldElementId+"-view-edit").on("click",jQuery.proxy(this.onClickEdit,this)),jQuery("#"+this.fieldElementId+"-edit-submit").on("click",jQuery.proxy(this.onClickPost,this)),jQuery("#"+this.fieldElementId+"-edit-cancel").on("click",jQuery.proxy(this.onClickCancel,this)),jQuery("#"+this.fieldElementId+"-close").on("click",jQuery.proxy(this.closeMemoField,this)),this.onMemoFieldOpenEvent=new grn.component.space.CustomEvent("onMemoFieldOpen"),this.onMemoFieldCloseEvent=new grn.component.space.CustomEvent("onMemoFieldClose")},grn.component.space.MemoField.prototype.addMemoFieldOpenEventSubscriber=function(subscriber){this.onMemoFieldOpenEvent.subscribe(subscriber)},grn.component.space.MemoField.prototype.addMemoFieldCloseEventSubscriber=function(subscriber){this.onMemoFieldCloseEvent.subscribe(subscriber)},grn.component.space.MemoField.prototype.openMemoField=function(){if(this.isMemoFieldClosed()){this.memoData.status=grn.component.space.MemoField.STATUS_SHOW,jQuery("#"+this.fieldElementId).show();var openStatus="1",request;new grn.component.ajax.request({url:this.resource.statusPost,method:"post",grnRedirectOnLoginError:true,data:{spid:this.memoData.spaceId,status:"1",csrf_ticket:this.resource.csrfTicket}}).send(),this.onMemoFieldOpenEvent.fire(this)}},grn.component.space.MemoField.prototype.closeMemoField=function(){if(!this.isMemoFieldClosed()){this.memoData.status=grn.component.space.MemoField.STATUS_HIDE,jQuery("#"+this.fieldElementId).hide();var openStatus="0",request;new grn.component.ajax.request({url:this.resource.statusPost,method:"post",grnRedirectOnLoginError:true,data:{spid:this.memoData.spaceId,status:"0",csrf_ticket:this.resource.csrfTicket}}).send(),this.onMemoFieldCloseEvent.fire(this)}},grn.component.space.MemoField.prototype.toggleMemoField=function(){this.isMemoFieldClosed()?this.openMemoField():this.closeMemoField()},grn.component.space.MemoField.prototype.isMemoFieldClosed=function(){return this.memoData.status==grn.component.space.MemoField.STATUS_HIDE},grn.component.space.MemoField.prototype.onClickCancel=function(){var viewField,editField;jQuery("#"+this.fieldElementId+"-view").show(),jQuery("#"+this.fieldElementId+"-edit").hide()},grn.component.space.MemoField.prototype.onClickPost=function(e){grn.component.button(e.currentTarget).showSpinner();var data,grnEditor,editor="0",editorRadioElement=jQuery("#editor_on"),request;editorRadioElement.length&&editorRadioElement.is(":checked")&&(editor="1",(grnEditor=grn.component.editor.Editor.getInstanceById("spacememo_editor_id")).save()),data=jQuery("#spacememo_editor_id").val(),new grn.component.ajax.request({url:this.resource.memoPost,method:"post",dataType:"json",data:{spid:this.memoData.spaceId,editor:editor,data:data,csrf_ticket:this.resource.csrfTicket}}).send().done(jQuery.proxy(this.onPostMemoSuccess,this)),grn.component.button(e.currentTarget).hideSpinner()},grn.component.space.MemoField.prototype.onPostMemoSuccess=function(data,textStatus,response){this.updateMemoData(data),this.onClickCancel()},grn.component.space.MemoField.prototype.onClickEdit=function(){var viewField,editField;jQuery("#"+this.fieldElementId+"-view").hide(),jQuery("#"+this.fieldElementId+"-edit").show(),jQuery("#spacememo_editor_id").trigger("grn.textarea:resize")},grn.component.space.MemoField.prototype.updateMemoData=function(memoData){var memoFieldUserLink;if(this.memoData=memoData,0==jQuery("#"+this.fieldElementId+"-view-user-link").length){var memoFieldUserIcon=jQuery("#"+this.fieldElementId+"-view-user-icon"),memoFieldUserName=jQuery("#"+this.fieldElementId+"-view-user-name"),updateLinkField='<a id="space-memo-field-view-user-link" class="space-userName-grn" href="#"> '+jQuery("<p>").append(memoFieldUserIcon.clone()).html()+jQuery("<p>").append(memoFieldUserName.clone()).html()+"</a>";memoFieldUserIcon.remove(),memoFieldUserName.replaceWith(updateLinkField)}this.updateEditView()},grn.component.space.MemoField.prototype.updateEditView=function(){jQuery("#"+this.fieldElementId+"-view-content").html(this.memoData.dataDisplay);var memoFieldUserLink=jQuery("#"+this.fieldElementId+"-view-user-link"),memoFieldUserIcon=jQuery("#"+this.fieldElementId+"-view-user-icon"),memoFieldUserName=jQuery("#"+this.fieldElementId+"-view-user-name");null!=memoFieldUserLink&&memoFieldUserLink.attr("href",this.memoData.userLink),null!=memoFieldUserIcon&&memoFieldUserIcon.attr("src",this.memoData.userIcon),null!=memoFieldUserName&&memoFieldUserName.html(this.memoData.modifierName.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),jQuery("#"+this.fieldElementId+"-view-mtime").html(this.memoData.mtimeDisplay.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"))},grn.component.space.PopupMenu=function(popupMenuItemList){this.popupMenuItemList=popupMenuItemList,jQuery.each(this.popupMenuItemList,jQuery.proxy(function(i,v){v.setPopupMenu(this)},this))},grn.component.space.PopupMenu.CLASS_DIALOG_DIV="space-manageMenu-item-grn",grn.component.space.PopupMenu.CLASS_SWITCH_ON="icon-showMenu-grn",grn.component.space.PopupMenu.CLASS_SWITCH_OFF="icon-hideMenu-grn",grn.component.space.PopupMenu.prototype.render=function(switchElementId,dialogElementId){this.switchElementId=switchElementId,this.dialogElementId=dialogElementId;var switchElement=jQuery("#"+this.switchElementId),dialogElement=jQuery("<div>").addClass(grn.component.space.PopupMenu.CLASS_DIALOG_DIV).attr("id",this.dialogElementId).css("display","none"),dialogUlElement=jQuery("<ul>");dialogElement.append(dialogUlElement),jQuery.each(this.popupMenuItemList,function(i,v){dialogUlElement.append(v.createDom())}),dialogElement.insertBefore(switchElement);var self=this;jQuery(window).on("resize",function(){setTimeout(function(){self.setDialogPosition()},0)}),switchElement.on("click",function(){self.onClick()}),jQuery(window.document).on("click",jQuery.proxy(function(e){var target=jQuery(e.target);target.is(switchElement)||jQuery("#"+this.switchElementId).has(e.target).length||target.is(dialogElement)||jQuery("#"+this.dialogElementId).has(e.target).length||!dialogElement.is(":visible")||this.onClick()},this))},grn.component.space.PopupMenu.prototype.setDialogPosition=function(){var switchElement=jQuery("#"+this.switchElementId),switchOffset=cumulativeOffset(switchElement.get(0)),left=switchOffset[0]+switchElement.outerWidth(true)+10,top=switchOffset[1],dialogElement=jQuery("#"+this.dialogElementId);dialogElement.css({left:left-dialogElement.outerWidth(),top:top+2,width:dialogElement.outerWidth()})},grn.component.space.PopupMenu.prototype.toggleArrow=function(){var switchElement=jQuery("#"+this.switchElementId);switchElement.hasClass(grn.component.space.PopupMenu.CLASS_SWITCH_OFF)?(switchElement.addClass(grn.component.space.PopupMenu.CLASS_SWITCH_ON),switchElement.removeClass(grn.component.space.PopupMenu.CLASS_SWITCH_OFF)):(switchElement.removeClass(grn.component.space.PopupMenu.CLASS_SWITCH_ON),switchElement.addClass(grn.component.space.PopupMenu.CLASS_SWITCH_OFF))},grn.component.space.PopupMenu.prototype.onClick=function(){this.toggleArrow();var dialogElement=jQuery("#"+this.dialogElementId);this.setDialogPosition(),dialogElement.toggle(),dialogElement.is(":visible")&&this.setDialogPosition()},grn.component.space.PopupMenuItem=function(){},grn.component.space.PopupMenuItem.prototype.setPopupMenu=function(popupMenu){this.popupMenu=popupMenu},grn.component.space.PopupMenuItem.prototype.getPopupMenu=function(){return this.popupMenu},grn.component.space.PopupMenuItemLink=function(link,caption,onclick_function){this.link=link,this.caption=caption,this.popupMenu=null,this.onclickFun=onclick_function},YAHOO.lang.extend(grn.component.space.PopupMenuItemLink,grn.component.space.PopupMenuItem),grn.component.space.PopupMenuItemLink.prototype.createDom=function(){var li=jQuery("<li>"),a=jQuery("<a>").attr("href",this.link).html(this.caption);return a.innerHTML=this.caption,void 0!==this.onclickFun&&a.attr("onClick",this.onclickFun),li.append(a),li},grn.component.space.PopupMenuItemSpacer=function(){this.popupMenu=null},YAHOO.lang.extend(grn.component.space.PopupMenuItemSpacer,grn.component.space.PopupMenuItem),grn.component.space.PopupMenuItemSpacer.CLASS="space-manageMenu-item-separator-grn",grn.component.space.PopupMenuItemSpacer.prototype.createDom=function(){return jQuery("<li>").addClass(grn.component.space.PopupMenuItemSpacer.CLASS)},grn.component.space.PopupMenuItemEvent=function(caption){this.onClickEventSubscriber=new grn.component.space.CustomEvent("click"),this.caption=caption,this.captionElement=null,this.popupMenu=null},YAHOO.lang.extend(grn.component.space.PopupMenuItemEvent,grn.component.space.PopupMenuItem),grn.component.space.PopupMenuItemEvent.prototype.addOnClickEventSubscriber=function(onClickEventSubscriber){this.onClickEventSubscriber.subscribe(onClickEventSubscriber)},grn.component.space.PopupMenuItemEvent.prototype.createDom=function(){var li=jQuery("<li>"),a=jQuery("<a>").attr("href","javascript:");return a.on("click",jQuery.proxy(this.onClickEvent,this)),a.html(this.caption),li.append(a),this.captionElement=a,li},grn.component.space.PopupMenuItemEvent.prototype.onClickEvent=function(){this.getPopupMenu().onClick(),this.onClickEventSubscriber.fire(this)},grn.component.space.PopupMenuItemEvent.prototype.updateCaption=function(caption){this.caption=caption,this.captionElement.innerHTML=this.caption};