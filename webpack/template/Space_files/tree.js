function GRN_OrganizationSelector(elm_id,callback,blank_page,refer_page){this.elm_id=elm_id,this.callback=callback,this.blank_page=blank_page,this.refer_page=refer_page,jQuery("#"+this.elm_id).hide(),this.items=[],this.visible=false}function GRN_DropdownMenu(wrap_id,title_button,organization_button,facility_button,button_preference,organization_id,facility_id,organization_callback,facilitygroup_callback,blank_page,refer_page){this.wrap_id=wrap_id,this.title_button=title_button,this.organization_button=organization_button,this.facility_button=facility_button,this.button_preference=button_preference,this.organization_id=organization_id,this.facility_id=facility_id,this.organization_callback=organization_callback,this.organization=new GRN_OrganizationSelector(organization_id,organization_callback,blank_page,refer_page),this.facility=new GRN_FacilityGroupSelectManager(facility_id,facilitygroup_callback,blank_page);var facility_button_element=jQuery("#"+facility_button);facility_button_element.on("mouseover",function(){facility_button_element.addClass("dropdown_menu_mouse_over")}),facility_button_element.on("mouseout",function(){facility_button_element.removeClass("dropdown_menu_mouse_over")});var organization_button_element=jQuery("#"+organization_button);organization_button_element.length>0&&(organization_button_element.on("mouseover",function(){organization_button_element.addClass("dropdown_menu_mouse_over")}),organization_button_element.on("mouseout",function(){organization_button_element.removeClass("dropdown_menu_mouse_over")})),jQuery(document).on("click",this.handlerClick.bind(this)),GRN_DropdownMenu.instances=GRN_DropdownMenu.instances||[],GRN_DropdownMenu.instances[wrap_id]=this}GRN_OrganizationSelector.prototype={initialize:function(items){for(var i=0;i<items.length;i++)this.appendItem(items[i].id,items[i].name,items[i].is_selected,items[i].type);this.draw()},appendItem:function(id,name,is_selected,type){this.items.push(new GRN_OrganizationItem(id,name,this.callback,is_selected,type))},show:function(){this.visible||(this.visible=true,jQuery("#"+this.elm_id).show())},_makePopupDivElm:function(){var popup_div=document.createElement("div");return popup_div.setAttribute("id",this.elm_id+"-div"),popup_div.setAttribute("class","user_pulldown_base_grn"),this.el=popup_div,this.el},_makeMyGroupElm:function(){if(!jQuery("#"+this.elm_id+"-mygroup").length){var mygroup_div=document.createElement("div");mygroup_div.setAttribute("id",this.elm_id+"-mygroup"),mygroup_div.setAttribute("class","pulldown_mygroup_base_grn");var mygroup_name=grn.component.i18n.cbMsg("grn.schedule","mygroup_create"),mygroup_content='<span class="action_text_grn"><a target= "_blank" href="'+this.refer_page+'"><span class="icon_add16_2_mm_grn icon_inline_s_mm_grn"></span><span class="icon_inline_s_mm_text_grn">'+mygroup_name+"</span></a></span>";return mygroup_div.innerHTML=mygroup_content,this.el_mygroup=mygroup_div,this.el_mygroup}},_makePopupIframe:function(){var popup_iframe=document.createElement("iframe");return popup_iframe.setAttribute("id",this.elm_id+"-if"),popup_iframe.setAttribute("src",this.blank_page),popup_iframe.setAttribute("class","user_pulldown_iframe_grn"),popup_iframe.setAttribute("style","z-index:1002; position:absolute; border:0px;"),this.el_if=popup_iframe,this.el_if},draw:function(){var popup_div=this._makePopupDivElm(),popup_iframe=this._makePopupIframe(),mygroup_div=this._makeMyGroupElm(),element=jQuery("#"+this.elm_id);element.prepend(popup_div),element.append(popup_iframe),element.append(mygroup_div);var table=document.createElement("table");table.setAttribute("cellspacing","0"),table.setAttribute("cellpadding","0"),table.setAttribute("class","w_full_grn"),table.setAttribute("id",this.elm_id+"-table"),jQuery("#"+this.elm_id+"-div").html(table);var tbody=document.createElement("tbody");table.appendChild(tbody);for(var i=0;i<this.items.length;i++)tbody.appendChild(this.items[i].createElement())},setSize:function(title_width){var icon_size=37,margin=74,height_max=240,scroll_bar=17;this.show();var element=jQuery("#"+this.elm_id),div_element=jQuery("#"+this.elm_id+"-div"),mygroup_element=jQuery("#"+this.elm_id+"-mygroup"),iframe_element=jQuery("#"+this.elm_id+"-if"),table_element=jQuery("#"+this.elm_id+"-table");element.css({visibility:"hidden"}),div_element.css({width:"",height:""});var height=div_element.outerHeight(),width=div_element.outerWidth();this.items.length<=0&&(width=height=0,element.css({display:"none"}),div_element.css({display:"none"}),iframe_element.css({display:"none"}));var set_width=width;width<title_width&&(set_width=title_width),set_width+=74,height>240&&div_element.css({overflowY:"scroll"}),div_element.css({width:set_width+"px",height:Math.min(240,height)+"px"}),iframe_element.css({width:set_width-2+"px",height:Math.min(240,height)+"px"}),mygroup_element.css({width:div_element.width()+2,"margin-top":div_element.height()+7}),element.css({visibility:"visible"}),this.hide()},getWidth:function(title_width){this.setSize(title_width),this.show();var ret=jQuery("#"+this.elm_id+"-div").outerWidth();return this.hide(),ret},hide:function(){this.visible&&(this.visible=false,jQuery("#"+this.elm_id).hide())},removeDivIframeElement:function(){jQuery(this.el).remove(),jQuery(this.el_if).remove()},toggle:function(){this.visible?this.hide():this.show()},getEl:function(){return this.el},getSelectedItem:function(){for(var i=0;i<this.items.length;i++)if(this.items[i].isSelected())return this.items[i]},selectItem:function(gid){for(var i=0;i<this.items.length;i++)this.items[i].setSelected(this.items[i].gid==gid)},getItem:function(gid){var items=jQuery.grep(this.items,function(item,index){return item.gid===gid}),item_type_array=["primary","membership"];return 1===items.length?items[0]:items.length>1&&(jQuery.inArray(items[0].type,item_type_array)>-1?items[0]:items[1])}},GRN_DropdownMenu.getInstance=function(instance_id){return GRN_DropdownMenu.instances[instance_id]},GRN_DropdownMenu.prototype={handlerClick:function(event){var target=event.target,title_button_element=jQuery("#"+this.title_button),organization_button_element=jQuery("#"+this.organization_button),organization_id_element=jQuery("#"+this.organization_id),facility_button_element=jQuery("#"+this.facility_button),facility_id_element=jQuery("#"+this.facility_id);title_button_element.is(target)||title_button_element.has(target).length>0?this.button_preference==this.PreferOrganization?(this.organization.toggle(),this.facility.hide(),organization_button_element.length>0&&organization_button_element.toggleClass("dropdown_menu_select"),facility_button_element.removeClass("dropdown_menu_select")):(this.organization.hide(),this.facility.toggle(),organization_button_element.length>0&&organization_button_element.removeClass("dropdown_menu_select"),facility_button_element.toggleClass("dropdown_menu_select")):organization_button_element.is(target)||organization_button_element.has(target).length>0?(this.organization.toggle(),this.facility.hide(),organization_button_element.toggleClass("dropdown_menu_select"),facility_button_element.removeClass("dropdown_menu_select")):facility_button_element.is(target)||facility_button_element.has(target).length>0?(this.organization.hide(),this.facility.toggle(),organization_button_element.length>0&&organization_button_element.removeClass("dropdown_menu_select"),facility_button_element.toggleClass("dropdown_menu_select")):organization_id_element.has(target).length>0||facility_id_element.has(target).length>0||(this.organization.hide(),this.facility.hide(),organization_button_element.length>0&&organization_button_element.removeClass("dropdown_menu_select"),facility_button_element.length>0&&facility_button_element.removeClass("dropdown_menu_select"));var dropdown_arrow_image=jQuery("#dropdown_arrow_image");dropdown_arrow_image.length>0&&(this.facility.visible?dropdown_arrow_image.removeClass("pulldownbutton_arrow_down_grn").addClass("pulldownbutton_arrow_up_grn"):dropdown_arrow_image.removeClass("pulldownbutton_arrow_up_grn").addClass("pulldownbutton_arrow_down_grn"))},initializeOrganization:function(organization_items){this.organization.initialize(organization_items)},initializeFacilityGroup:function(f_params){this.facility.initialize(f_params.tree_name,f_params.page_name,f_params.ajax_path,f_params.callback,f_params.selectedOID,f_params.csrf_ticket,f_params.title_width,f_params.node_info)},prependSearchLabel:function(search_label){var node_info={oid:"search",extra_param:"search",name:search_label};this.facility.insertNode(node_info),jQuery("dl#group-select span#dropdown_title").html(search_label)},removeSearchLabel:function(){this.facility.fag_tree.removeSpecialNode("search")},PreferOrganization:1,PreferFacilityGroup:2};