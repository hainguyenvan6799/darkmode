grn.base.namespace("grn.html.com_header"),function($){"use strict";function updateNumberText(element,count,limit){if(0!==element.length&&String(count).match(/[0-9]+/g))if(0===(count=parseInt(count,10)))element.hide();else{var number=count>limit?limit+"+":count;element.show(),element.text(number)}}function updateNumberTitle(num,MAX_NUM,$menu_title_button,menu_title,left_parenthesis,right_parenthesis){num>MAX_NUM&&(num=MAX_NUM+"+"),menu_title+=left_parenthesis+num+right_parenthesis,$menu_title_button.attr("title",menu_title),$menu_title_button.attr("aria-label",menu_title)}function doAjaxGetNumberNotification(){$.ajax({url:get_number_notification_url,type:"POST",dataType:"text",headers:{"X-Cybozu-Session-No-Prolonging":"true"},success:function(data,textStatus,jqXHR){if(!comHeaderUtil.is_XCybozuError_Exists(jqXHR)){var data_number_notify=JSON.parse(data);G.updateNotificationNumber(data_number_notify.number),G.updateFavourNumber(data_number_notify.favour_notify_number),G.setNextUpdateNotification(data_number_notify.time_update)}},error:comHeaderUtil.onFailure})}var G=grn.html.com_header;G.updateNotificationNumber=function(num){var MAX_NOTIFICATION_NUM=99;updateNumberText($("#notification_number"),num,99),updateNumberTitle(num,99,$("#cloudHeader-grnNotificationTitle-grn"),grn.component.i18n.cbMsg("grn.notification","notification_header_menu_title"),grn.component.i18n.cbMsg("grn.notification","notification_header_menu_left_parenthesis"),grn.component.i18n.cbMsg("grn.notification","notification_header_menu_right_parenthesis"))},G.updateFavourNumber=function(num){var MAX_FAVOUR_NUM=20;updateNumberText($("#favour_notify_number"),num,20),updateNumberTitle(num,20,$("#cloudHeader-grnFavourTitle-grn"),grn.component.i18n.cbMsg("grn.favour","favour_header_menu_title"),grn.component.i18n.cbMsg("grn.favour","favour_header_menu_left_parenthesis"),grn.component.i18n.cbMsg("grn.favour","favour_header_menu_right_parenthesis"))},G.setNextUpdateNotification=function(delay){0!==delay&&setTimeout(doAjaxGetNumberNotification,delay)},$(window).bind("load resize",function(){G.setDropDownHeight()}),G.setDropDownHeight=function(){$("#header").find(".cloudHeader-dropdownMenu-open-grn").each(function(){var contents=$(this).find("div.cloudHeader-dropdownContents-grn"),max_height=.9*($(window).height()-$("#header").height());contents.css("max-height",max_height+"px")})},G.addEventListenerForResizeWindow=function(){$(window).bind("load resize",function(){G.setMaxWidthOfHeaderUsername(),G.setWidthOfHeader()}),$(window).bind("scroll",function(){"undefined"!==typeof $("#container-wrap").offset()&&$("#header-wrap").offset({left:$("#container-wrap").offset().left})})},G.setMaxWidthOfHeaderUsername=function(){var width=150;$(window).width()>1e3&&(width=(width+=$(window).width()-1e3)<300?width:300),$("#cloudHeader-userName-grn span").css("max-width",width+"px")},G.setWidthOfHeader=function(){$("#header-wrap").css({width:$("body").width()})};var comHeaderUtil={is_XCybozuError_Exists:function(jqXHR){return jqXHR.getAllResponseHeaders().match(new RegExp(/X-Cybozu-Error/i))},onFailure:function(jqXHR){try{var errorJSON=JSON.parse(jqXHR.responseText);if("undefined"==typeof errorJSON.code)return;"GRN_CMMN_00105"==errorJSON.code&&(location.href=location.href)}catch(e){}}};$(window.document).bind("click",function(e){if(0==e.which||1==e.which){var target=$(e.target),header,openMenu=$("#header").find(".cloudHeader-dropdownMenu-open-grn"),openedTargetParent=target.parents(".cloudHeader-dropdownMenu-open-grn"),update=target.hasClass("cloudHeader-grnNotification-update-grn")?target:target.parents(".cloudHeader-grnNotification-update-grn"),spinnerSet=function(element){element.html('<div align="center">'+link_spiner+"</div>"),element.height("20px"),element.prev("iframe").height(element.height()+"px").width(element.width()+"px")},getContents=function(url,contentElm){$.ajax({url:url,type:"POST",dataType:"text",success:function(data,textStatus,jqXHR){comHeaderUtil.is_XCybozuError_Exists(jqXHR)?comHeaderUtil.onFailure(jqXHR):(contentElm.html(data),contentElm.height(""),setTimeout("grn.html.com_header.setDropDownHeight()",100),url.includes("grn/ajax_get_favour_notify_list")&&G.updateFavourNumber(0))},error:comHeaderUtil.onFailure})},openDropDownMenu=function($dropDownMenu){$dropDownMenu.addClass("cloudHeader-dropdownMenu-open-grn"),$dropDownMenu.find("button").attr("aria-expanded",true),$dropDownMenu.find(".cloudHeader-dropdownContents-grn").attr("aria-hidden",false)},closeDropDownMenu=function($dropDownMenu){$dropDownMenu.removeClass("cloudHeader-dropdownMenu-open-grn"),$dropDownMenu.find("button").attr("aria-expanded",false),$dropDownMenu.find(".cloudHeader-dropdownContents-grn").attr("aria-hidden",true)};if(update.length>0){var updateElm=update.parent(),isNotification,url="popup_notification_header"==updateElm.get(0).id?get_data_notification_url:get_favour_notify_list_url,updateIcon=update.find("span.icon-reload-grn");return updateIcon.removeClass("icon-reload-grn"),updateIcon.addClass("icon-spinner-grn"),void getContents(url,updateElm)}if(openMenu.length>0&&0==target.parents("div.cloudHeader-dropdownContents-grn").length&&closeDropDownMenu(openMenu),!(openedTargetParent.length>0)&&0!=target.parents("div.cloudHeader-grn").length)try{if(target.parents(".cloudHeader-spaceApplication-grn").length>0){if(ajax_my_space_list_url){var $space_application=$("#popup_spaceApplication");spinnerSet($space_application),openDropDownMenu($("#cloudHeader-dropdownContents-spaceApplication")),getContents(ajax_my_space_list_url,$space_application)}}else if(target.parents(".cloudHeader-startMenu-grn").length>0||target.parents(".header_appmenu_grn").length>0){if(ajax_app_menu_url){var $start_application=$("#cloudHeader-startApplicationmenu-grn");$start_application.length<1&&($start_application=$("#header_pulldown_appmenu_base_grn")),spinnerSet($start_application);var $dropdown_content=$("#cloudHeader-dropdownContents-startMenu");$dropdown_content.length<1&&($dropdown_content=$("#header_pulldown_appmenu_grn")),openDropDownMenu($dropdown_content),getContents(ajax_app_menu_url,$start_application)}}else if(target.parents(".cloudHeader-userProfile-grn").length>0){var $user_name=$("#cloudHeader-userName-grn"),$user_profile_contents=$("#cloudHeader-userProfile-grn");openDropDownMenu(target.parents(".cloudHeader-dropdownMenu-grn")),$user_profile_contents.width()<$user_name.width()&&$user_profile_contents.css("width",$user_name.width()+"px"),G.setDropDownHeight()}else if(target.parents(".cloudHeader-admin-grn").length>0)openDropDownMenu(target.parents(".cloudHeader-dropdownMenu-grn")),G.setDropDownHeight();else if(target.parents("#tag-grnFavour-grn").length>0){var $favour_contents=$("#popup_favour_header");spinnerSet($favour_contents),openDropDownMenu(target.parents(".cloudHeader-dropdownMenu-grn")),getContents(get_favour_notify_list_url,$favour_contents)}else if(target.parents("#tag-grnNotification-grn").length>0){var $notification_contents=$("#popup_notification_header");spinnerSet($notification_contents),openDropDownMenu(target.parents(".cloudHeader-dropdownMenu-grn")),getContents(get_data_notification_url,$notification_contents)}}catch(err){}}})}(jQuery);